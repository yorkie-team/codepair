CHANGED_FILES=$(git diff --cached --name-only)

LINT_FRONTEND=false
LINT_BACKEND=false
LINT_UI=false
LINT_CODEMIRROR=false

for FILE in $CHANGED_FILES; do
  if [[ "$FILE" =~ ^packages/frontend/ ]]; then
    LINT_FRONTEND=true
  elif [[ "$FILE" =~ ^packages/backend/ ]]; then
    LINT_BACKEND=true
  elif [[ "$FILE" =~ ^packages/ui/ ]]; then
    LINT_UI=true
  elif [[ "$FILE" =~ ^packages/codemirror/ ]]; then
    LINT_CODEMIRROR=true
  fi
done

if [ "$LINT_FRONTEND" = true ]; then
  echo "Changes detected in the frontend. Linting & Formatting frontend..."
  cd packages/frontend
  npx lint-staged
  if [ $? -ne 0 ]; then
    echo "Frontend Linting & Formatting failed. Commit aborted."
    exit 1
  fi
  cd ../..
fi

if [ "$LINT_BACKEND" = true ]; then
 echo "Changes detected in the backend. Linting & Formatting backend..."
  cd packages/backend
  npx lint-staged
  if [ $? -ne 0 ]; then
    echo "Backend Linting & Formatting failed. Commit aborted."
    exit 1
  fi
  cd ../..
fi

if [ "$LINT_UI" = true ]; then
  echo "Changes detected in ui. Linting & Formatting ui..."
  cd packages/ui
  npx lint-staged
  if [ $? -ne 0 ]; then
    echo "UI Linting & Formatting failed. Commit aborted."
    exit 1
  fi
  cd ../..
fi

if [ "$LINT_CODEMIRROR" = true ]; then
  echo "Changes detected in codemirror. Linting & Formatting codemirror..."
  cd packages/codemirror
  npx lint-staged
  if [ $? -ne 0 ]; then
    echo "CodeMirror Linting & Formatting failed. Commit aborted."
    exit 1
  fi
  cd ../..
fi
